<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mimi Downloader</title>
<link href="cdn/3.3.7/css/bootstrap.min.css" rel="stylesheet">
<style>
	.checkbox {
		margin: 0px auto !important;
	}
	.info, #download, #nav {
		display: none;
		margin-top: 20px;
	}
	img {
		max-width: 80%;
	}/*
	table {
		word-break: break-all;
		word-wrap: break-all;
	}*/
</style>
</head>
<body>
<div class="container" style="margin: 0 20px 20px 20px;">
	<div class="row">
		<h1>Mimi Downloader</h1>
		<p id="help">欢迎使用米米下载器，轻松下载视频、弹幕</p>
	</div>
	
	<div class="row">
		<div class="form-group">
		视频地址
			<input type="text" class="form-control" id="videoUrl"/>
		</div>
	</div>
	
	<div class="row">
		<div class="form-group">
		PlayUrl
			<input type="text" class="form-control" id="playUrl"/>
		</div>
	</div>

	<div class="row">
		<button class="btn btn-success" onclick="getData()">获取下载链接</button>
		<button class="btn btn-default" onclick="help()">帮助</button>
		<button class="btn btn-default" onclick="about()">关于</button>
	</div>
	
	<ul class="nav nav-tabs row" id="nav">
		<li role="presentation" class="active" onclick="changeMenu(0)"><a>下载地址</a></li>
		<li role="presentation" onclick="changeMenu(1)"><a>视频信息</a></li>
	</ul>

	<div class="info">
		<div class="row">
			<div class="form-group">
			视频CID：
				<span id="cid"></span>
			&nbsp;&nbsp;&nbsp;
			清晰度：
				<span id="quality"></span>
			&nbsp;&nbsp;&nbsp;下载弹幕：
				<button class="btn btn-success" onclick="xml()">.xml</button>
				<button class="btn btn-primary" onclick="ass()">.ass</button>
			</div>
		</div>

		<div class="row">
			<table class="table table-striped">
				<thead>
					<tr>
						<th>编号</th>
						<th>时长(ms)</th>
						<th>大小(bit)</th>
						<th>选定</th>	
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
	
		<div class="row">
			<div class="form-group">
			下载路径
				<input type="text" class="form-control" id="downloadPath"/>
			</div>
		</div>

		<div class="row">
			<button class="btn btn-success" onclick="download()">下载选中片段</button>
			<button class="btn btn-primary" onclick="selectAll()">全选</button>
			<button class="btn btn-default" onclick="selectReverse()">反选</button>
			<button class="btn btn-danger" onclick="selectNone()">全不选</button>
		</div>

		<div class="row" id="download">
		</div>
	</div>

	<div class="info">
		<div class="row">
			<table class="table table-striped">
				<thead>
					<tr>
						<th>Key</th>
						<th>Value</th>	
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
	</div>
</div>

<script src="cdn/jquery-3.2.1.min.js"></script>
<script>if (typeof module === "object") { window.jQuery = window.$ = module.exports; }</script>
<script src="ass.js"></script>
<script src="panel.js"></script>
<script>
window.addEventListener("beforeunload", e => {
	if (isDownloading) {
		e.returnValue = false;
		alert("下载时无法退出，请先结束任务");
	}
});
function help() {
	alert("请填写视频地址（视频播放界面的url）以及PlayUrl（使用html5播放器，查看浏览器的XHR请求中名称为playurl的项的地址），然后点击“获取下载链接”进行下一步。");
}
function about() {
	alert("Mimi Downloader Ver 1.0.1\n\nWe are using Node.js " + process.versions.node + ", Chromium " + process.versions.chrome + ", and Electron " + process.versions.electron + ". Powered by Mimi.");
}
function changeMenu(index) {
	$(".info").eq(!index).hide();
	$(".info").eq(index).fadeIn();
	$("li").eq(index).addClass("active");
	$("li").eq(!index).removeClass("active");
}
function selectAll() {
	$('input[type="checkbox"]').prop("checked", true);
}
function selectNone() {
	$('input[type="checkbox"]').prop("checked", false);
}
function selectReverse() {
	$('input[type="checkbox"]').each(function () {
		$(this).prop("checked", !$(this).prop("checked"));
	});
}
</script>
</body>
</html>
