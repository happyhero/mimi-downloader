<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mimi Downloader</title>
<link href="cdn/3.3.7/css/bootstrap.min.css" rel="stylesheet">
<style>
	.checkbox {
		margin: 0px auto !important;
	}
	.mt20 {
		margin-top: 20px;
	}
	.info, #nav, .glyphicon {
		display: none;
	}
	.has-feedback .glyphicon {
		display: block;
	}
	table img {
		max-width: 80%;
	}
	#bg {
		width: 100%;
		z-index: -1;
	}
	.input-group-addon {
		cursor: pointer;
	}
	.capitalize {
		text-transform: capitalize; /*首字母大写*/
	}
	/*
	table {
		word-break: break-all;
		word-wrap: break-all;
	}*/
</style>
</head>
<body>
<div class="container" style="margin: 0 20px 20px 20px;">
	<div class="row">
		<h1>Mimi Downloader</h1>
		<p id="help">欢迎使用米米下载器，轻松下载视频、弹幕</p>
	</div>

	<div class="row">
		<div class="form-group">
			<label class="control-label">视频链接</label>
			<input type="text" class="form-control" id="videoUrl"/>
  			<span class="glyphicon glyphicon-remove form-control-feedback"></span>
		</div>
	</div>
	
	<div class="row">
		<div class="form-group">
			<label class="control-label">PlayUrl</label>
			<input type="text" class="form-control" id="playUrl"/>
  			<span class="glyphicon glyphicon-remove form-control-feedback"></span>
		</div>
	</div>

	<div class="row">
		<button class="btn btn-success" onclick="getAid()">获取下载链接</button>
		<button class="btn btn-default" onclick="help()">帮助</button>
		<button class="btn btn-default" onclick="about()">关于</button>
	</div>
	
	<ul class="nav nav-tabs row mt20" id="nav">
		<li role="presentation" class="active" onclick="changeMenu(0)"><a>下载地址</a></li>
		<li role="presentation" onclick="changeMenu(1)"><a>视频信息</a></li>
	</ul>

	<div class="info mt20">
		<div class="row">
			<div class="form-group">
				<label class="control-label">视频CID：</label>
				<span id="cid"></span>
			&nbsp;&nbsp;&nbsp;
				<label class="control-label">清晰度：</label>
				<span id="quality"></span>
			&nbsp;&nbsp;&nbsp;
				<label class="control-label">下载弹幕：</label>
				<button class="btn btn-success" onclick="xml()">.xml</button>
				<button class="btn btn-primary" onclick="ass()">.ass</button>
			</div>
		</div>

		<div class="row">
			<table class="table table-striped">
				<thead>
					<tr>
						<th>编号</th>
						<th>时长(s)</th>
						<th>大小(MB)</th>
						<th>选定</th>	
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>

			<button class="btn btn-primary" onclick="selectAll()">全选</button>
			<button class="btn btn-default" onclick="selectReverse()">反选</button>
			<button class="btn btn-danger" onclick="selectNone()">全不选</button>
		</div>
	
		<div class="row">
			<div class="form-group mt20">
				<label class="control-label">下载路径</label>
				<div class="input-group">
					<input type="text" class="form-control" id="downloadPath"/>
				  	<div class="input-group-addon" onclick="openDialog()">浏览</div>
				</div>
			</div>
		</div>

		<div class="row">
			<button class="btn btn-success" onclick="download()">下载选中片段</button>
			<button class="btn btn-primary" onclick="openPath()">打开下载目录</button>
		</div>

		<div class="row mt20" id="download">
		</div>
	</div>

	<div class="info mt20">
		<div class="row">
			<table class="table table-striped">
				<thead>
					<tr>
						<th>Key</th>
						<th>Value</th>	
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
	</div>

	<img src="bg.png" id="bg" class="mt20">
</div>

<script src="cdn/jquery-3.2.1.min.js"></script>
<script>if (typeof module === "object") { window.jQuery = window.$ = module.exports; }</script>
<script src="ass.js"></script>
<script src="panel.js"></script>
<script>
window.addEventListener("beforeunload", e => {
	if (downloadArray.length) {
		e.returnValue = false;
		alert("[Error]下载时无法退出，请先结束任务！");
	}
});

$("button").each(function() {
    $(this).get(0).addEventListener("click", function() {
    	this.blur();
    });
});

$("#downloadPath").val(__dirname);

function help() {
	alert("请填写视频链接（即视频播放界面的url），以及PlayUrl（请用浏览器打开视频链接，选择html5播放器播放视频，在浏览器的开发者菜单中查看XHR请求，找到名称为playurl的项，将其地址填入输入框内），然后点击“获取下载链接”进行下一步。");
}
function about() {
	alert("Mimi Downloader Ver 1.1.0\n\nWe are using Node.js " + process.versions.node + ", Chromium " + process.versions.chrome + ", and Electron " + process.versions.electron + ". Powered by Mimi.");
}
function changeMenu(index) {
	$(".info").eq(!index).hide();
	$(".info").eq(index).fadeIn();
	$("li").eq(index).addClass("active");
	$("li").eq(!index).removeClass("active");
}
function selectAll() {
	$('input[type="checkbox"]').prop("checked", true);
}
function selectNone() {
	$('input[type="checkbox"]').prop("checked", false);
}
function selectReverse() {
	$('input[type="checkbox"]').each(function () {
		$(this).prop("checked", !$(this).prop("checked"));
	});
}
</script>
</body>
</html>
